<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Progress Board</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="stylesheet" href="style.css">
</head>

<body class="bg-light text-dark">
    <div id="pageLoader">
        <div class="spinner-border text-primary" role="status"></div>
    </div>

    <nav class="navbar navbar-expand-lg ftco_navbar ftco-navbar-light" id="ftco-navbar">
        <div class="container">
            <a class="navbar-brand" href="index.html">Progress Board</a>
            <!-- Dark Mode Toggle Switch -->
            <div class="theme-toggle me-3">
                <input type="checkbox" id="themeToggleSwitch" class="theme-toggle-input">
                <label for="themeToggleSwitch" class="theme-toggle-label">
                    <i class="bi bi-sun theme-icon sun"></i>
                    <i class="bi bi-moon-stars theme-icon moon"></i>
                    <span class="theme-toggle-ball"></span>
                </label>
            </div>
            <div class="d-flex align-items-center ms-auto" id="navbarButtons"></div>
        </div>
    </nav>

    <div class="container">
        <div id="alertContainer"></div>
        <div class="fade-in">
            <div id="homeContent">
            <div class="hero">
                <div class="hero-content">
                    <div class="hero-badge">
                        <i class="bi bi-lightning-charge"></i>
                        <span>Boost Your Productivity</span>
                        </div>
                        <h1 class="display-3 hero-title">Stay on Track with <span class="text-gradient">Progress Board</span></h1>
                        <p class="hero-subtitle">Transform your workflow with intelligent task management, real-time collaboration, and insightful progress tracking. Built for teams and individuals who value productivity.</p>
                        <div class="hero-buttons">
                            <button id="getStartedBtn" class="btn btn-primary btn-lg me-3">
                                <i class="bi bi-rocket-takeoff me-2"></i>Get Started Free
                            </button>
                            <button onclick="window.location.href='https://github.com/jay-1409'" class="btn btn-outline-light btn-lg">
                                <i class="bi bi-github me-2"></i>View on GitHub
                            </button>
                        </div>
                        <div class="hero-stats">
                            <div class="stat-item">
                                <div class="stat-number">10K+</div>
                                <div class="stat-label">Tasks Completed</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number">500+</div>
                                <div class="stat-label">Active Users</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number">99.9%</div>
                                <div class="stat-label">Uptime</div>
                            </div>
                        </div>
                    </div>
                    <div class="hero-visual">
                        <div class="floating-card card-1">
                            <i class="bi bi-check-circle-fill text-success"></i>
                            <span>Task Completed</span>
                        </div>
                        <div class="floating-card card-2">
                            <i class="bi bi-people-fill text-primary"></i>
                            <span>Team Collaboration</span>
                        </div>
                        <div class="floating-card card-3">
                            <i class="bi bi-graph-up text-warning"></i>
                            <span>Progress Tracking</span>
                        </div>
                    </div>
                </div>

                <section id="features" class="features-section">
                    <div class="section-header text-center">
                        <h2 class="section-title">Why Choose Progress Board?</h2>
                        <p class="section-subtitle">Discover the features that make task management effortless and effective</p>
                    </div>
                    <div class="row features-grid">
                        <div class="col-lg-4 col-md-6 mb-4">
                            <div class="feature-card">
                                <div class="feature-icon">
                                    <i class="bi bi-calendar-check"></i>
                                </div>
                                <h4>Smart Task Management</h4>
                                <p>Organize your daily tasks with intelligent scheduling, priority management, and automated reminders that keep you on track.</p>
                                <ul class="feature-list">
                                    <li><i class="bi bi-check2"></i> Priority-based sorting</li>
                                    <li><i class="bi bi-check2"></i> Due date tracking</li>
                                    <li><i class="bi bi-check2"></i> Progress visualization</li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-6 mb-4">
                            <div class="feature-card">
                                <div class="feature-icon">
                                    <i class="bi bi-people"></i>
                                </div>
                                <h4>Team Collaboration</h4>
                                <p>Create groups, assign tasks, and collaborate seamlessly with your team members in a focused, productive environment.</p>
                                <ul class="feature-list">
                                    <li><i class="bi bi-check2"></i> Real-time updates</li>
                                    <li><i class="bi bi-check2"></i> Task assignment</li>
                                    <li><i class="bi bi-check2"></i> Group management</li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-6 mb-4">
                            <div class="feature-card">
                                <div class="feature-icon">
                                    <i class="bi bi-graph-up-arrow"></i>
                                </div>
                                <h4>Progress Analytics</h4>
                                <p>Get detailed insights into your productivity with comprehensive reports and visual progress tracking that motivates you to achieve more.</p>
                                <ul class="feature-list">
                                    <li><i class="bi bi-check2"></i> Detailed reports</li>
                                    <li><i class="bi bi-check2"></i> Performance metrics</li>
                                    <li><i class="bi bi-check2"></i> Goal tracking</li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-6 mb-4">
                            <div class="feature-card">
                                <div class="feature-icon">
                                    <i class="bi bi-shield-check"></i>
                                </div>
                                <h4>Secure & Reliable</h4>
                                <p>Your data is protected with enterprise-grade security and backed up with 99.9% uptime guarantee.</p>
                                <ul class="feature-list">
                                    <li><i class="bi bi-check2"></i> End-to-end encryption</li>
                                    <li><i class="bi bi-check2"></i> Regular backups</li>
                                    <li><i class="bi bi-check2"></i> GDPR compliant</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="how-it-works" class="how-it-works-section">
                    <div class="section-header text-center">
                        <h2 class="section-title">How It Works</h2>
                        <p class="section-subtitle">Get started in just three simple steps</p>
                    </div>
                    <div class="row steps-container">
                        <div class="col-lg-4 text-center">
                            <div class="step-item">
                                <div class="step-number">1</div>
                                <div class="step-icon">
                                    <i class="bi bi-person-plus"></i>
                                </div>
                                <h4>Sign Up</h4>
                                <p>Create your free account in seconds with email verification for security.</p>
                            </div>
                        </div>
                        <div class="col-lg-4 text-center">
                            <div class="step-item">
                                <div class="step-number">2</div>
                                <div class="step-icon">
                                    <i class="bi bi-plus-circle"></i>
                                </div>
                                <h4>Add Tasks</h4>
                                <p>Create tasks, set priorities, and organize them into groups for better management.</p>
                            </div>
                        </div>
                        <div class="col-lg-4 text-center">
                            <div class="step-item">
                                <div class="step-number">3</div>
                                <div class="step-icon">
                                    <i class="bi bi-graph-up"></i>
                                </div>
                                <h4>Track Progress</h4>
                                <p>Monitor your progress, collaborate with team members, and achieve your goals.</p>
                            </div>
                        </div>
                    </div>
                </section>


                <section id="cta" class="cta-section">
                    <div class="cta-content">
                        <h2 class="cta-title">Ready to Boost Your Productivity?</h2>
                        <p class="cta-subtitle">Join thousands of users who have already transformed their workflow with Progress Board</p>
                        <div class="cta-buttons">
                            <button id="ctaGetStartedBtn" class="btn btn-primary btn-lg me-3">
                                <i class="bi bi-rocket-takeoff me-2"></i>Start Free Today
                            </button>
                            <button class="btn btn-outline-primary btn-lg">
                                <i class="bi bi-play-circle me-2"></i>Watch Demo
                            </button>
                        </div>
                        <div class="cta-features">
                            <div class="cta-feature">
                                <i class="bi bi-check-circle-fill"></i>
                                <span>Free forever plan</span>
                            </div>
                            <div class="cta-feature">
                                <i class="bi bi-check-circle-fill"></i>
                                <span>No credit card required</span>
                            </div>
                            <div class="cta-feature">
                                <i class="bi bi-check-circle-fill"></i>
                                <span>Setup in 2 minutes</span>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <div id="userDashboardPreview" class="mt-4" style="display: none;">
                <div class="card">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <h4 class="mb-0">Your Dashboard</h4>
                        <button class="btn btn-light btn-sm" onclick="window.location.href='dashboard.html'">Go to
                            Dashboard</button>
                    </div>
                    <div class="card-body">
                        <p>You're already logged in! Access your groups and tasks from your personal dashboard.</p>
                        <div class="d-grid gap-2">
                            <button class="btn btn-outline-primary" onclick="window.location.href='dashboard.html'">
                                <i class="bi bi-grid"></i> View Dashboard
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="loginModalLabel">Login</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="loginForm" onsubmit="event.preventDefault(); handleLogin();">
                            <input type="email" id="loginEmail" class="form-control" placeholder="Email" required>
                            <input type="password" id="loginPassword" class="form-control" placeholder="Password"
                                required>
                            <div class="modal-footer p-0 pt-3">
                                <button id="loginSubmitBtn" type="submit" class="btn btn-primary w-100">
                                    <span id="loginSpinner" class="spinner-border spinner-border-sm d-none"
                                        role="status" aria-hidden="true"></span>
                                    Login
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="signupModal" tabindex="-1" aria-labelledby="signupModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="signupModalLabel">Sign Up</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="signupForm" onsubmit="event.preventDefault(); initiateSignup();">
                            <input type="text" id="signupUsername" class="form-control" placeholder="set username"
                                required>
                            <input type="email" id="signupEmail" class="form-control" placeholder="enter email"
                                required>
                            <input type="password" id="signupPassword" class="form-control" placeholder="set password"
                                required>
                            <small id="emailWarning" class="text-warning d-block mt-1">
                                ⚠️ Please enter a valid, real email address to receive OTP code.
                            </small>
                            <div class="modal-footer p-0 pt-3">
                                <button id="signupSubmitBtn" type="submit" class="btn btn-success w-100">
                                    <span id="signupSpinner" class="spinner-border spinner-border-sm d-none"
                                        role="status" aria-hidden="true"></span>
                                    Sign Up
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="otpVerificationModal" tabindex="-1" aria-labelledby="otpVerificationModalLabel"
            aria-hidden="true" data-bs-backdrop="static">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="otpVerificationModalLabel">Email Verification</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>We've sent a verification code to your email. Please enter the code below:</p>
                        <p>Do check the spam incase you cant find the mail</p>
                        <form id="otpVerificationForm" onsubmit="event.preventDefault(); verifyOtp();">
                            <div class="otp-input-container">
                                <input type="text" maxlength="1" class="form-control otp-input" id="otp1" required>
                                <input type="text" maxlength="1" class="form-control otp-input" id="otp2" required>
                                <input type="text" maxlength="1" class="form-control otp-input" id="otp3" required>
                                <input type="text" maxlength="1" class="form-control otp-input" id="otp4" required>
                            </div>
                            <p>
                                <span id="resendTimerContainer" class="resend-timer">Resend in <span
                                        id="resendTimer">60</span>s</span>
                                <span id="resendOtpBtn" class="resend-otp" style="display: none;"
                                    onclick="resendOtp()">Resend OTP</span>
                            </p>
                            <div class="modal-footer p-0 pt-3">
                                <button id="verifyOtpBtn" type="submit" class="btn btn-primary w-100">
                                    <span id="otpVerificationSpinner" class="spinner-border spinner-border-sm d-none"
                                        role="status" aria-hidden="true"></span>
                                    Verify
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <footer class="app-footer mt-5 border-top">
            <div class="footer-inner">
                <div class="footer-brand">
                    <div class="footer-logo">
                        <i class="bi bi-kanban-fill"></i>
                        <span>Progress Board</span>
                    </div>
                    <p class="footer-tagline">Track, collaborate, and celebrate progress with your team.</p>
                </div>
                <div class="footer-links">
                    <h6>Product</h6>
                    <a href="#homeContent">Overview</a>
                    <a href="#features">Features</a>
                    <a href="#how-it-works">How it works</a>
                </div>
                <div class="footer-links">
                    <h6>Resources</h6>
                    <a href="dashboard.html">Dashboard</a>
                    <a href="https://github.com/jay-1409" target="_blank" rel="noopener">GitHub</a>
                </div>
            </div>
            <div class="footer-bottom">
                <div class="footer-social">
                    <a href="https://x.com" target="_blank" rel="noopener" aria-label="X">
                        <i class="bi bi-twitter-x"></i>
                    </a>
                    <a href="https://www.linkedin.com" target="_blank" rel="noopener" aria-label="LinkedIn">
                        <i class="bi bi-linkedin"></i>
                    </a>
                    <a href="https://github.com/jay-1409" target="_blank" rel="noopener" aria-label="GitHub">
                        <i class="bi bi-github"></i>
                    </a>
                </div>
                <p class="footer-copy mb-0">&copy; 2025 Progress Board. All rights reserved.</p>
            </div>
        </footer>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <script>
            const BASE_URL = 'https://progress-board-1409-20917d01.koyeb.app';
            //const BASE_URL = 'http://localhost:8081';

            // Global variables to track request states
            let isLoggingIn = false;
            let isSigningUp = false;
            let isVerifyingOtp = false;
            let resendOtpTimer = null;
            let resendOtpCountdown = 60;

            // Temporary storage for signup data
            let pendingSignup = {
                username: '',
                email: '',
                password: ''
            };

            // Show alert messages
            function showAlert(message, type = 'danger') {
                const alertContainer = document.getElementById('alertContainer');
                const alertId = 'alert-' + Date.now();

                const alertDiv = document.createElement('div');
                alertDiv.id = alertId;
                alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
                alertDiv.role = 'alert';
                alertDiv.style.display = 'block';

                alertDiv.innerHTML = `
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        `;

                alertContainer.appendChild(alertDiv);

                // Auto dismiss after 5 seconds
                setTimeout(() => {
                    const alert = document.getElementById(alertId);
                    if (alert) {
                        alert.classList.add('fade-out');
                        setTimeout(() => {
                            if (alert && alert.parentNode) {
                                alert.parentNode.removeChild(alert);
                            }
                        }, 500);
                    }
                }, 5000);

                return alertId;
            }

            // Toggle button loading state
            function toggleButtonLoading(buttonId, spinnerID, isLoading) {
                const button = document.getElementById(buttonId);
                const spinner = document.getElementById(spinnerID);

                if (button && spinner) {
                    button.disabled = isLoading;

                    if (isLoading) {
                        spinner.classList.remove('d-none');
                    } else {
                        spinner.classList.add('d-none');
                    }
                }
            }

            // Handle OTP input auto-focus
            document.addEventListener('DOMContentLoaded', function () {
                const otpInputs = document.querySelectorAll('.otp-input');

                otpInputs.forEach((input, index) => {
                    // Only allow numbers
                    input.addEventListener('input', function (e) {
                        this.value = this.value.replace(/[^0-9]/g, '');

                        // Auto focus to next input
                        if (this.value && index < otpInputs.length - 1) {
                            otpInputs[index + 1].focus();
                        }
                    });

                    // Handle backspace to go to previous input
                    input.addEventListener('keydown', function (e) {
                        if (e.key === 'Backspace' && !this.value && index > 0) {
                            otpInputs[index - 1].focus();
                        }
                    });
                });
            });

            // Start resend OTP timer
            function startResendOtpTimer() {
                resendOtpCountdown = 60;
                document.getElementById('resendTimer').textContent = resendOtpCountdown;
                document.getElementById('resendTimerContainer').style.display = 'inline';
                document.getElementById('resendOtpBtn').style.display = 'none';

                clearInterval(resendOtpTimer);
                resendOtpTimer = setInterval(() => {
                    resendOtpCountdown--;
                    document.getElementById('resendTimer').textContent = resendOtpCountdown;

                    if (resendOtpCountdown <= 0) {
                        clearInterval(resendOtpTimer);
                        document.getElementById('resendTimerContainer').style.display = 'none';
                        document.getElementById('resendOtpBtn').style.display = 'inline';
                    }
                }, 1000);
            }

            // Reset OTP input fields
            function resetOtpInputs() {
                const otpInputs = document.querySelectorAll('.otp-input');
                otpInputs.forEach(input => {
                    input.value = '';
                });
                otpInputs[0].focus();
            }

            // Initialize OTP verification modal
            function initOtpVerification(email) {
                resetOtpInputs();
                startResendOtpTimer();

                // Show OTP verification modal
                const otpModal = new bootstrap.Modal(document.getElementById('otpVerificationModal'));
                otpModal.show();

                // Focus on first OTP input field
                setTimeout(() => {
                    document.getElementById('otp1').focus();
                }, 500);
            }

            // Send OTP email
            async function sendOtpEmail(email) {
                try {
                    const response = await fetch(`${BASE_URL}/Auth/Send-Otp-Mail?to=${encodeURIComponent(email)}`, {
                        method: 'POST'
                    });

                    if (response.ok) {
                        return true;
                    } else {
                        throw new Error('Failed to send OTP');
                    }
                } catch (error) {
                    console.error('Error sending OTP:', error);
                    return false;
                }
            }

            // Verify OTP
            async function verifyOtp() {
                if (isVerifyingOtp) return;

                // Collect OTP digits
                const otp1 = document.getElementById('otp1').value;
                const otp2 = document.getElementById('otp2').value;
                const otp3 = document.getElementById('otp3').value;
                const otp4 = document.getElementById('otp4').value;
                //       const otp5 = document.getElementById('otp5').value;
                //     const otp6 = document.getElementById('otp6').value;

                // Validate all digits are filled
                if (!otp1 || !otp2 || !otp3 || !otp4) {
                    showAlert('Please enter all 4 digits of the OTP');
                    return;
                }

                const otpCode = parseInt(`${otp1}${otp2}${otp3}${otp4}`);
                isVerifyingOtp = true;
                toggleButtonLoading('verifyOtpBtn', 'otpVerificationSpinner', true);

                try {
                    // Verify OTP with backend
                    const response = await fetch(`${BASE_URL}/Auth/validate-email?receiverMail=${encodeURIComponent(pendingSignup.email)}&enteredOtp=${otpCode}`);

                    if (response.ok) {
                        const result = await response.text();

                        if (result === 'true') {
                            // OTP verified, proceed with signup
                            completeSignup();
                        } else {
                            showAlert('Invalid OTP. Please try again.');
                            resetOtpInputs();
                        }
                    } else {
                        showAlert('Failed to verify OTP. Please try again.');
                    }
                } catch (error) {
                    console.error('Error verifying OTP:', error);
                    showAlert('Network error occurred during OTP verification.');
                } finally {
                    isVerifyingOtp = false;
                    toggleButtonLoading('verifyOtpBtn', 'otpVerificationSpinner', false);
                }
            }

            // Resend OTP
            async function resendOtp() {
                const success = await sendOtpEmail(pendingSignup.email);

                if (success) {
                    showAlert('OTP has been resent to your email.', 'info');
                    startResendOtpTimer();
                } else {
                    showAlert('Failed to resend OTP. Please try again.');
                }
            }

            // Initial signup process
            async function initiateSignup() {
                if (isSigningUp) return;

                isSigningUp = true;
                toggleButtonLoading('signupSubmitBtn', 'signupSpinner', true);

                // Store signup data
                pendingSignup = {
                    username: document.getElementById('signupUsername').value,
                    email: document.getElementById('signupEmail').value,
                    password: document.getElementById('signupPassword').value
                };

                try {
                    // Send OTP to the user's email
                    const otpSent = await sendOtpEmail(pendingSignup.email);

                    if (otpSent) {
                        // Close signup modal
                        const signupModal = bootstrap.Modal.getInstance(document.getElementById('signupModal'));
                        if (signupModal) signupModal.hide();

                        // Show OTP verification modal
                        initOtpVerification(pendingSignup.email);
                    } else {
                        showAlert('Failed to send verification code. Please try again.');
                    }
                } catch (error) {
                    console.error('Error during signup initiation:', error);
                    showAlert('Network error occurred during signup.');
                } finally {
                    isSigningUp = false;
                    toggleButtonLoading('signupSubmitBtn', 'signupSpinner', false);
                }
            }

            // Complete signup after OTP verification
            async function completeSignup() {
                try {
                    toggleButtonLoading('verifyOtpBtn', 'otpVerificationSpinner', true);

                    // Create user account
                    const res = await fetch(`${BASE_URL}/user`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            username: pendingSignup.username,
                            email: pendingSignup.email,
                            password: pendingSignup.password
                        })
                    });

                    if (res.ok) {
                        // If signup successful, now login the user automatically
                        const loginRes = await fetch(`${BASE_URL}/Auth/obId?email=${encodeURIComponent(pendingSignup.email)}&inPass=${encodeURIComponent(pendingSignup.password)}`);

                        if (loginRes.ok) {
                            const userId = await loginRes.text();
                            localStorage.setItem('userId', userId.toString());

                            // Close the OTP modal
                            const otpModal = bootstrap.Modal.getInstance(document.getElementById('otpVerificationModal'));
                            if (otpModal) otpModal.hide();

                            // Show success message
                            showAlert('Signup successful! Redirecting to dashboard...', 'success');

                            // Update UI immediately to reflect logged-in state
                            updateUIForLoggedInUser();

                            // Clear the pending signup data
                            pendingSignup = { username: '', email: '', password: '' };

                            // Redirect after a short delay
                            setTimeout(() => {
                                window.location.href = 'dashboard.html';
                            }, 1500);

                            const url = `${BASE_URL}/group/add-member/${userId}/68243568bf164034f66583cd?inPsas=wlc`;
                            try {
                                const res = await fetch(url, {
                                    method: 'PUT'
                                });

                                if (res.ok) {
                                    // Close the modal
                                    const joinModal = bootstrap.Modal.getInstance(document.getElementById('joinGroupModal'));
                                    if (joinModal) joinModal.hide();

                                    // Show success message
                                    showAlert('Successfully joined the group!', 'success');

                                    // Clear the form
                                    document.getElementById('joinGroupForm').reset();

                                    // Refresh groups list
                                    await fetchUserGroups();
                                } else {
                                    const errorText = await res.text();
                                    showAlert(`Failed to join group: ${errorText || 'Please check your credentials.'}`);
                                }
                            } catch (error) {
                                console.error('Error joining group:', error);
                                showAlert('Network error occurred while trying to join the group.');
                            } finally {
                                isJoiningGroup = false;
                                toggleButtonLoading('joinSubmitBtn', 'joinSpinner', false);
                            }
                        } else {
                            showAlert('Signup successful but login failed. Please try logging in manually.');
                        }
                    } else {
                        const errorText = await res.text();
                        showAlert(`Signup failed: ${errorText || 'Please try again.'}`);
                    }
                } catch (error) {
                    console.error('Error during signup completion:', error);
                    showAlert('Network error occurred during signup.');
                } finally {
                    toggleButtonLoading('verifyOtpBtn', 'otpVerificationSpinner', false);
                }
            }

            async function handleLogin() {
                if (isLoggingIn) return; // Prevent multiple submissions

                isLoggingIn = true;
                toggleButtonLoading('loginSubmitBtn', 'loginSpinner', true);

                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;

                try {
                    // First, validate the user credentials
                    const res = await fetch(`${BASE_URL}/Auth/validate?email=${encodeURIComponent(email)}&inPass=${encodeURIComponent(password)}`);
                    const result = await res.text();

                    if (res.ok && result === 'true') {
                        // If credentials are valid, fetch the ObjectId of the user
                        const userIdRes = await fetch(`${BASE_URL}/Auth/obId?email=${encodeURIComponent(email)}&inPass=${encodeURIComponent(password)}`);

                        if (userIdRes.ok) {
                            const userId = await userIdRes.text(); // The response will contain the ObjectId of the user
                            localStorage.setItem('userId', userId.toString());

                            // Close the modal
                            const loginModal = bootstrap.Modal.getInstance(document.getElementById('loginModal'));
                            if (loginModal) loginModal.hide();

                            // Show success message
                            showAlert('Login successful! Redirecting to dashboard...', 'success');

                            // Update UI immediately to reflect logged-in state
                            updateUIForLoggedInUser();

                            // Redirect after a short delay
                            setTimeout(() => {
                                window.location.href = 'dashboard.html';
                            }, 1500);
                        } else {
                            showAlert('Failed to retrieve user data.');
                        }
                    } else {
                        showAlert('Invalid credentials: incorrect password or account does not exist.');
                    }
                } catch (error) {
                    console.error('Error during login:', error);
                    showAlert('Network error occurred during login.');
                } finally {
                    isLoggingIn = false;
                    toggleButtonLoading('loginSubmitBtn', 'loginSpinner', false);
                }
            }

            // Update navbar based on login state
            function updateNavbar() {
                const navbarButtons = document.getElementById('navbarButtons');
                const userId = localStorage.getItem('userId');

                if (userId) {
                    // User is logged in
                    navbarButtons.innerHTML = `
                <button class="btn btn-outline-primary me-2" onclick="window.location.href='dashboard.html'">Dashboard</button>
                <button class="btn btn-danger" onclick="handleLogout()">Logout</button>
            `;
                } else {
                    // User is not logged in
                    navbarButtons.innerHTML = `
                <button class="btn btn-outline-primary me-2" data-bs-toggle="modal" data-bs-target="#loginModal">Login</button>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#signupModal">Sign Up</button>
            `;
                }
            }

            // Update UI elements for logged-in user
            function updateUIForLoggedInUser() {
                // Update navbar
                updateNavbar();

                // Show dashboard preview section
                document.getElementById('userDashboardPreview').style.display = 'block';

                // Update "Get Started" button to redirect to dashboard
                const getStartedBtn = document.getElementById('getStartedBtn');
                getStartedBtn.textContent = 'Go to Dashboard';
                getStartedBtn.onclick = function () { window.location.href = 'dashboard.html'; };
            }

            // Logout handler
            function handleLogout() {
                localStorage.removeItem('userId');
                showAlert('You have been logged out successfully!', 'success');

                // Update UI for logged-out state
                updateNavbar();
                document.getElementById('userDashboardPreview').style.display = 'none';

                // Reset "Get Started" button
                const getStartedBtn = document.getElementById('getStartedBtn');
                getStartedBtn.textContent = 'Get Started';
                localStorage.clear();
                getStartedBtn.onclick = function () {
                    const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
                    loginModal.show();
                };
            }

            // Initialize the page
            window.onload = function () {
                // Check if user is logged in
                const userId = localStorage.getItem('userId');

                // Set up "Get Started" button behavior
                const getStartedBtn = document.getElementById('getStartedBtn');
                const ctaGetStartedBtn = document.getElementById('ctaGetStartedBtn');
                
                if (userId) {
                    // User is logged in - update UI accordingly
                    updateUIForLoggedInUser();
                } else {
                    // User is not logged in - setup login modal trigger
                    const showLoginModal = function () {
                        const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
                        loginModal.show();
                    };
                    
                    getStartedBtn.onclick = showLoginModal;
                    if (ctaGetStartedBtn) {
                        ctaGetStartedBtn.onclick = showLoginModal;
                    }
                }

                // Always update navbar
                updateNavbar();
            };
            window.addEventListener('load', () => {
                const loader = document.getElementById('pageLoader');
                loader.style.opacity = '0';
                setTimeout(() => {
                    loader.style.display = 'none';
                }, 500);

                // Optional: add fade-in class to content
                document.querySelectorAll('.fade-in').forEach(el => {
                    el.style.opacity = '1';
                });

                // Initialize scroll animations
                initScrollAnimations();
            });

            // Scroll animations with Intersection Observer
            function initScrollAnimations() {
                const observerOptions = {
                    threshold: 0.1,
                    rootMargin: '0px 0px -50px 0px'
                };

                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add('animated');
                            observer.unobserve(entry.target);
                        }
                    });
                }, observerOptions);

                // Add animation classes to elements
                const animateElements = document.querySelectorAll(
                    '.feature-card, .testimonial-card, .step-item, .section-header'
                );
                
                animateElements.forEach(el => {
                    el.classList.add('animate-on-scroll');
                    observer.observe(el);
                });

                // Add staggered animation delays
                document.querySelectorAll('.feature-card').forEach((card, index) => {
                    card.style.animationDelay = `${index * 0.1}s`;
                });

                document.querySelectorAll('.testimonial-card').forEach((card, index) => {
                    card.style.animationDelay = `${index * 0.1}s`;
                });

                document.querySelectorAll('.step-item').forEach((item, index) => {
                    item.style.animationDelay = `${index * 0.2}s`;
                });
            }

        </script>
    <script>
        // Theme Toggle Script using the navbar switch
        (function () {
            const themeToggleSwitch = document.getElementById('themeToggleSwitch');
            if (!themeToggleSwitch) return;

            const applyTheme = (isDark) => {
                document.body.classList.toggle('dark-mode', isDark);
                themeToggleSwitch.checked = isDark;
            };

            // Apply stored preference if exists
            const storedPref = localStorage.getItem('theme');
            applyTheme(storedPref === 'dark');

            // Listen for toggle changes
            themeToggleSwitch.addEventListener('change', (e) => {
                const isDark = e.target.checked;
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
                applyTheme(isDark);
            });
        })();
    </script>
</body>

</html>